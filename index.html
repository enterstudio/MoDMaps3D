<!DOCTYPE html>
<html lang="en">
<head>
	<title>MoDMaps3D - Three Dimensional Molecular Distance Maps</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
	<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script>
	<script type="text/javascript" src="js/numeric-1.2.6.min.js"></script>
	
	<script>
	var dbg = false, errorHasOccured = false;
	var eigenval, eigenvec, eigensystem, finalEigenval, finalEigenvec, points ;
	var mapID, allSequences={}, distMatrix=[], fcgrRes=9, getTaxa = false;
	var accIDs, step1A, step1B, step2A, step2B, step3A, step3B, time;
	var callsNCBIDone, progress;
	var labelColors = ['blue', 'red', 'green', 'orange', 'magenta', 'yellow', 'brown', 'lime', 'gray', 'pink','cyan','seagreen', 'yellow'];
	
	function computeMDS(){
		time = new Date();
		step3A = time.getTime();
		console.log("BEGIN computeMDS()");	
		
		// pre-processign MDS

		// part 1
		var numOfSeq = distMatrix.length;
		var distMatrixSqTotals = [];
		for(var i=0; i<numOfSeq; i++){
			var tmpColSum = 0;
			for(var j=0; j<numOfSeq; j++){
				tmpColSum += Math.pow(distMatrix[i][j], 2);
			}
			distMatrixSqTotals.push(tmpColSum);
		}
		if(dbg){console.log('sqtotals=',distMatrixSqTotals);}
		
		// part 2
		var sumOfSqTotals = 0;
		for(var i=0; i<numOfSeq; i++){
			sumOfSqTotals += distMatrixSqTotals[i];
		}
		if(dbg){console.log('sumofsqtotals=',sumOfSqTotals);}
		
		// part 3
		var distMatrixCentered = [];
		for(var i=0; i<numOfSeq; i++){
			distMatrixCentered.push([]);
			for(var j=0; j<numOfSeq; j++){
				var tmpVal = -(1/2)*(Math.pow(distMatrix[i][j], 2) - (1/numOfSeq)*distMatrixSqTotals[i] - (1/numOfSeq)*distMatrixSqTotals[j] + (1/(Math.pow(numOfSeq, 2)))* sumOfSqTotals);
				distMatrixCentered[i].push(tmpVal);
			}
		}
		
		// EIGENVALUES - EIGENVECTORS
		res2 = numeric.eig(distMatrixCentered);
		if(dbg){console.log('numeric.js=',res2['lambda']['x']);}

		eigenval = res2['lambda']['x'];
		eigenvec = numeric.transpose(res2['E']['x']);   /// here transpose!!!
		eigensystem =[];
		for(var i=0; i<numOfSeq; i++){
			eigensystem.push([eigenval[i], eigenvec[i]]);
		}
		if(dbg){console.log("eigensystem=",eigensystem);}
		eigensystem.sort(function (a,b){ return Math.abs(b[0]) - Math.abs(a[0]) });
		if(dbg){console.log("eigensystem=",eigensystem);}
		

		// PICK 5 LARGEST AND POSITIVE
		finalEigenvec=[];
		finalEigenval=[];
		for(var i=0; i<numOfSeq; i++){
			if(eigensystem[i][0]>0){
				finalEigenvec.push(eigensystem[i][1]);
				finalEigenval.push(eigensystem[i][0]);
			}
			if(dbg){console.log("i-th eigeinvalue= [",i,"] [",eigensystem[i][0],"]");}
			if(finalEigenvec.length === 5){break;}
		}
		if(dbg){console.log("finalEigenval=",finalEigenval);}
		if(dbg){console.log("finalEigenvec=",finalEigenvec);}
		
		// POINTS COORDINATES
		points = numeric.dot(numeric.transpose(finalEigenvec), numeric.sqrt(numeric.T.diag(finalEigenval)['x']));
		if(dbg){console.log("points=",points);}
		
		// MIN-MAX PER DIMENSION (FOR LATER SCALING)
		var allMinMax =[], tmpMinMax = numeric.transpose(points);
		for(var i=0; i<5; i++){
			allMinMax.push( [ Math.min.apply(Math,tmpMinMax[i]) , Math.max.apply(Math,tmpMinMax[i]) ] );
		}
		if(dbg){console.log(allMinMax);}
		

		// PRODUCING MAPFILE
		var mapfile = '';
		// line 1
		for(var i=0; i<accIDsSets.length; i++){
			mapfile += accIDsSets[i].length + ",";
		}
		mapfile = mapfile.slice(0,-1);
		mapfile += "\n";
		// line 2
		for(var i=0; i<accIDsSets.length; i++){
			mapfile += $("#colorset"+i).val() + ",";
		}
		mapfile = mapfile.slice(0,-1);
		mapfile += "\n";
		// line 3+4
		mapfile += "5\nIndex,Acc,Name,Length,Taxa\n";
		// line 5
		for(var i=0; i<accIDsSets.length; i++){
			mapfile += $("#colorset"+i).val() + ",";
		}
		mapfile = mapfile.slice(0,-1);
		mapfile += "\n";
		// line 6
		for(var i=0; i<accIDsSets.length; i++){
			mapfile += $("#nameset"+i).val()+" ("+accIDsSets[i].length+"),";
		}
		mapfile = mapfile.slice(0,-1);
		mapfile += "\n";
		// line 7
		mapfile += "No Description given\n";
		// rest of the lines
		for(var i=0; i<numOfSeq; i++){
			for(var j=0; j<points[i].length; j++){
				mapfile += ((2*points[i][j] - allMinMax[j][0] - allMinMax[j][1]) / ( allMinMax[j][1] - allMinMax[j][0] ) ) +"\n";	
			}
			mapfile += i+"\n";                      // INDEX
			mapfile += allSequences[i][0]+"\n";     // ACC
			mapfile += allSequences[i][4].split("|").pop().trim()+"\n";     // NAME
			mapfile += allSequences[i][1]+"\n";     // LENGTH
			mapfile += allSequences[i][2]+"\n";     // TAXA
		}
		mapfile = mapfile.slice(0,-1);
		if(dbg){console.log("c/p=\n",mapfile);}

		var mapTimeStamp = new Date().getTime();
		if(typeof(Storage) !== "undefined") {
			localStorage.setItem("mapfile"+mapTimeStamp, mapfile);
			localStorage.setItem("distMatrix"+mapTimeStamp, distMatrix);
		} else {
			console.log("ERROR! NO LOCAL STORAGE AVAILABLE!?");
			alert("ERROR! NO LOCAL STORAGE AVAILABLE!?");
		}

		$('#ncbiprogress').html('100%');
		$("#file_contents").html('<pre>'+mapfile+'</pre>');
		$("#file_contents").hide();
		// END OF MDS
		

		time = new Date();
		step3B = time.getTime();
		$("#stepstatus").html('\
			<p><strong>Step 1 (NCBI + FCGRs) DONE in ~'+(step1B-step1A)/1000+' sec</p>\
			<p>Step 2 (AID) DONE in ~'+(step2B-step2A)/1000+' sec</p>\
			<p>Step 3 (MDS) DONE in ~'+(step3B-step3A)/1000+' sec</p></strong>');
		$("#stepstatus").html($("#stepstatus").html()+'<p>Map file <a href="load.html?mapid=local'+mapTimeStamp+'" target="_blank">here</a> or <a href="#" id="viewfile">view</a> contents.</p>');
		$("#mainprogressbar").hide();
		$("#viewfile").click(function(){
			$("#file_contents").toggle();
		});

		// list local storage for debuging
		if(dbg){for (var a in localStorage) {console.log(a);}}
		if(dbg){console.log(Object.keys(localStorage));}
	}

	function computeDistMatrix(){
		time = new Date();
		step2A = time.getTime();
		console.log("BEGIN computeDistMatrix()");	
		$("#stepstatus").html('\
			<p><strong>Step 1 (NCBI + FCGRs) DONE in ~'+(step1B-step1A)/1000+' sec</strong></p>\
			<p>Step 2 of 3: (AID)</p>');
		$('#ncbiprogress').html('0%');

		var dim=accIDs.length;
		distMatrix=[];
		for(var i=0; i<dim; i++){
			distMatrix.push([]);
			for(var j=0; j<dim; j++){
				distMatrix[i].push(0);
			}
		}
		
		var s = 1;
		var process = function() {
			for (; s<= (dim-1)*dim/2; s++) {
				var sum=0, frow, fcol;
				for(var row=dim-1; row>=1; row--){
					sum+=row;
					//console.log(s,dim,row,sum);
					if(sum >= s){
						//ACTUAL ROW OF TRIANGULAR NUMBER
						frow = dim-row;
						sum=0;
						for(var col=dim-1; col>=dim-frow+1; col--){sum+=col;}
						// ACTUAL COLUMN OF TRIANGULAR NUMBER
						fcol=s-sum+frow;
						break;
					}
				}
				if(dbg){console.log("s=",s,"frow=",frow,"fcol=",fcol);}

				var numerator = allSequences[frow-1][3]['size'] + allSequences[fcol-1][3]['size'];
				//var denominator = mergeKmers(allSequences[frow-1][3],allSequences[fcol-1][3]);
				var denominator=0;
				for(var unionInd=0; unionInd<Math.pow(4,fcgrRes); unionInd++){
					if( (allSequences[frow-1][3]['flatFCGR'][unionInd]==1) || (allSequences[fcol-1][3]['flatFCGR'][unionInd]==1) ){
						denominator++;
					} 
				}
				if(dbg){console.log(frow,fcol,'=',numerator,denominator,2 - numerator*1.0/denominator);}
				distMatrix[frow-1][fcol-1] = 2 - numerator*1.0/denominator;
				distMatrix[fcol-1][frow-1] = distMatrix[frow-1][fcol-1];

				var progress = 2*s*100.0/ (dim*(dim-1));
				progress = progress.toFixed(2);
				if(dbg){console.log('progr='+progress);}

				if( s%10 == 0){
					if(dbg){console.log('ABOUT-TO-BREAK = '+s);}
					$('#ncbiprogress').html(progress+'%');
					s++;
					var myvar = setTimeout(process, 10);
					break;
				}
			}
			if(s==(dim-1)*dim/2 + 1){
				time = new Date();
				step2B = time.getTime();
				// YOU HAVE COMPUTED DISTANCE MATRIX, PRINT IT AND GO FOR MDS
				if(dbg){console.log(distMatrix);}

				//DEBUGING FOR PRINTING dMatrix
				if(dbg){
					console.log('matrix=',distMatrix);
					var toprint="[";
					for(var i=0; i<distMatrix.length; i++){
						toprint+='';
						for (var j=0; j<distMatrix.length; j++){
							toprint+=distMatrix[i][j]+',';
						}
						toprint = toprint.substring(0, toprint.length - 1);
						toprint+=';'
					}
					toprint = toprint.substring(0, toprint.length - 1);
					toprint+=']';
					console.log('COPY/PASTE MATHEMATICA');
					console.log("Eigenvalues[",toprint,"]");
					//$("#accessionIDs").html("Eigenvalues["+toprint+"]");
				}


				$("#stepstatus").html('\
					<p><strong>Step 1 (NCBI + FCGRs) DONE in ~'+(step1B-step1A)/1000+' sec</p>\
					<p>Step 2 (AID) DONE in ~'+(step2B-step2A)/1000+' sec</p></strong>\
					<p>Step 3 of 3: (MDS)</p>');
				$('#ncbiprogress').html('Please wait.. (browser may freeze for a while) <img src="img/loading.gif" width="30" height="30"/>');

				setTimeout(computeMDS, 500);
			}
		};

		process();
	}

	function buildFCGR(seq, k){
		var numOfKmers=0, curmer, curmerInd, kmers={}, mapACGT={"A":0, "C":1, "G":2, "T":3};
		var newseq = seq.replace(/B|D|E|F|H|I|J|K|L|M|N|O|P|Q|R|S|U|V|W|X|Y|Z/gi, "");
	    var kmersInds = new Uint8Array(Math.pow(4, k));
	    if(dbg){console.log((seq.length - newseq.length)+' lost bp');}
	    for(var i=0; i<newseq.length-k+1; i++){
			curmer = newseq.slice(i,i+k);
			curmerInd = 0;
			for(var j=0; j<curmer.length; j++){ 
				curmerInd += Math.pow(4, k-1-j)*mapACGT[curmer[j]]; 
			}
			
			if(kmersInds[curmerInd]==0){
				numOfKmers++;
				kmersInds[curmerInd]=1;
			}

		}
		if(dbg){console.log(numOfKmers+' #kmers '+kmersInds.length);}
		return {"size":numOfKmers, "flatFCGR":kmersInds};
	}

	function loadFastaFromNCBI(ind, accID, callback){
		$.ajax({
			url: "http://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nuccore&rettype=fasta&retmode=text&id="+accID,
			success: function(result){
				var data = result.split(/\n\r?/gi);
				var header;
				if( data.length && data[0][0]==='>' ){ header = data[0]; }
				while (data.length && data[0][0] === '>') {data.shift();}
				var outputFasta=data.join('');
				if(dbg){console.log('['+accID+'] len='+outputFasta.length);}
				callback(ind, accID, outputFasta, header);
			},
			error: function(xhr, status, error) {
				console.log('STATUS=',status,'ERROR from loadFastaFromNCBI=',error);
				errorHasOccured = true;
				$('#ncbiprogress').html('ERROR ['+error+'] while fetching data from NCBI for ['+accID+']');
			}
		});
	}

	function getTaxaFromNCBI(ind, idNCBI){
		if(dbg){console.log("getting taxa for id=",id);}
		$.ajax({
			url: "http://eutils.ncbi.nlm.nih.gov/entrez/eutils/efetch.fcgi?db=nucleotide&rettype=gb&retmode=xml&id="+idNCBI,
			success: function(result){
				// res=result;
				// console.log("res=", result);
				var taxaString = new XMLSerializer().serializeToString(result);
				var taxa = /<GBSeq_taxonomy>(.*)<\/GBSeq_taxonomy>/g.exec(taxaString);
				if(dbg){console.log("taxa=", taxa[1]);}
				allSequences[ind][2] = taxa[1].trim();
				
				callsNCBIDone += 0.5;
				progress = callsNCBIDone*100.0/accIDs.length;
				progress = progress.toFixed(2);
				if(!errorHasOccured){$('#ncbiprogress').html(progress+'%');}
				if(callsNCBIDone == accIDs.length){
					time = new Date();
					step1B = time.getTime();
					computeDistMatrix();
				}
			},
			error: function(xhr, status, error) {
				console.log('STATUS=',status,'ERROR getTaxaFromNCBI=',error);
				errorHasOccured = true;
				$('#ncbiprogress').html('ERROR ['+error+'] while fetching Taxonomy data from NCBI for ['+accID+']');
			}
		});		
	}

	$(document).ready(function(){

		$.ajax({url: "browse.php", success: function(result){
			// LOAD FILENAMES FROM MAPS DIRECTORY
			// HARDCODE FILENAMES. ALTERNATIVELY, COMMENT FOLLOWING LINE
			result = 'animalia01.txt#animalia02.txt#animalia03.txt#animalia04.txt#animalia05.txt#animalia06.txt#animalia06_comp.txt#animalia07.txt#animalia07_comp.txt#animalia08.txt#animalia08_comp.txt#animalia09.txt#animalia09_comp.txt#animalia10.txt#animalia10_comp.txt#animalia10_comp_asm.txt#archaea1.txt#archaea2.txt#archaea3.txt#archaea4.txt#bacteria1.txt#bacteria2.txt#bacteria3.txt#bacteria4.txt#bacteria5.txt#bacteria5_comp.txt#fungi1.txt#fungi2.txt#fungi3.txt#fungi4.txt#fungi5.txt#fungi5_comp.txt#plants1.txt#plants2.txt#plants3.txt#plants4.txt#plants5.txt#plants6.txt#plants7.txt#plants7_comp_cp.txt#plants8.txt#plants8_comp_cp.txt#plants8_comp_cp_mt.txt#plants8_comp_mt.txt#protists1.txt#protists2.txt#protists3.txt#protists4.txt#zz_map2.txt#zz_map8.txt';
			var resfetch=result.split("#");
			var outcome='';
			for(i=0;i<resfetch.length;i++){outcome+='<a href="#" class="list-group-item">'+resfetch[i]+'</a>';}
			$("#mainfilenavigate").html('<p><span class="label label-primary">Available Maps</span></p><div id="filenavigate">'+outcome+'</div>');
			// LOAD PREVIEW CONTENT FOR EACH FILENAME
			$(".list-group-item").click(function() {
				console.log('Loading = '+$(this).html());
				mapID=$(this).html();
				$.ajax({
					url: "maps/"+$(this).html(), 
					success: function(result){
						var resfetch=result.split("\n");
						$("#filecontent").html('<p id="mapId"><strong>'+resfetch[5]+'</strong></p><p>'+resfetch[6]+'</p><a href="load.html?mapid='+mapID+'" target="_blank">Show Map</a><p></p>');
					}
				});
			});
		}});

		$("#goto1").click(function(){$('#guide-tabs li:eq(1) a').tab('show');});
		$("#goto2").click(function(){$('#guide-tabs li:eq(2) a').tab('show');});
		$("#kmerslen").val('9');
		$("#getTaxa").val('0');

		$("#dataset1").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('1');
			$("#numofsets").trigger("change");
			$("#set0").html('NC_012920,NC_013993,NC_023100,NC_014453,NC_012761,NC_012762,NC_012763');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();
		}); 
		$("#dataset2").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('2');
			$("#numofsets").trigger("change");
			$("#set0").html('NC_014453,NC_012761,NC_012762,NC_012763,NC_012764,NC_012766,NC_012769,NC_012771,NC_012773,NC_011053,NC_010299,NC_010300,NC_004025,NC_002765');
			$("#set1").html('NC_018115,NC_018116,NC_018096,NC_018057,NC_018058,NC_018059,NC_018060,NC_018061,NC_018062,NC_018063,NC_016666,NC_015485,NC_015486,NC_014042,NC_014045,NC_014047,NC_014051,NC_013993,NC_012920,NC_012774,NC_012775,NC_012670,NC_011519,NC_011137,NC_011120,NC_009747,NC_009748,NC_008215,NC_008216,NC_008217,NC_008218,NC_008219,NC_008220,NC_008066,NC_007009,NC_006900,NC_006901,NC_005943,NC_002811,NC_002763,NC_002764,NC_001643,NC_001644,NC_001645,NC_001646,NC_001992,NC_002082,NC_002083');	
			$("#nameset0").val('Strepsirrhini');
			$("#nameset1").val('Haplorrhini');
			$("#colorset0").val('green');
			$("#colorset1").val('red');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();		
		});  
		$("#dataset3").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('1');
			$("#numofsets").trigger("change");
			$("#set0").html('NC_015669,NC_013473,NC_013475,NC_013476,NC_013477,NC_013478,NC_013482,NC_013484,NC_007683,NC_007684,NC_007685,NC_004024,NC_003055,NC_017931,NC_015304,NC_015303,NC_012369,NC_012447,NC_012448,NC_012450,NC_012451,NC_012423,NC_012425,NC_012426,NC_009960,NC_009961,NC_009336,NC_008288,NC_008279,NC_007232,NC_007233,NC_007243,NC_002375,NC_002235,NC_015981,NC_014262,NC_008337,NC_008338,NC_008339,NC_003029,NC_001324,NC_000862,NC_013986,NC_010653,NC_007787,NC_006862,NC_002508,NC_000895,NC_001637,NC_009902,NC_011005,NC_015622,NC_015606,NC_015616,NC_015619,NC_014280,NC_009384,NC_009385,NC_005984,NC_002387,NC_016738,NC_013837,NC_016739,NC_013710,NC_007405,NC_018042,NC_011212,NC_011213,NC_010637,NC_002572');
			$("#nameset0").val('Protists');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();
		}); 
		$("#dataset4").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('3');
			$("#numofsets").trigger("change");
			$("#set0").html('NC_017870,NC_017871,NC_015788,NC_015790,NC_015791,NC_015792,NC_015794,NC_015795,NC_015796,NC_014568,NC_014571,NC_014572,NC_013825,NC_013762,NC_012430,NC_010224,NC_009335,NC_008090,NC_008085,NC_008088,NC_008089,NC_008091,NC_008076,NC_008077,NC_008078,NC_008079,NC_008080,NC_008081,NC_008082,NC_008083,NC_008084,NC_007446,NC_006887,NC_006888,NC_006889,NC_006890,NC_006407,NC_006325,NC_006326,NC_006327,NC_006328,NC_006329,NC_006330,NC_006331,NC_006332,NC_006333,NC_006334,NC_006335,NC_006336,NC_006337,NC_006338,NC_006339,NC_006340,NC_006341,NC_006342,NC_006343,NC_006344,NC_006345,NC_006346,NC_005797,NC_004926,NC_004021,NC_002756');
			$("#set1").html('NC_007911,NC_006404,NC_006301,NC_006302,NC_006303,NC_006304,NC_006305,NC_002471');
			$("#set2").html('NC_016119,NC_016059,NC_015615,NC_015617,NC_015618,NC_015620,NC_015305,NC_014685,NC_014691,NC_014581,NC_014584,NC_013270,NC_012837,NC_012647,NC_011049,NC_010232,NC_010233,NC_009886,NC_009422,NC_009423,NC_009258,NC_009264,NC_008410,NC_008144,NC_007888,NC_007440,NC_007178,NC_006839,NC_006688,NC_006689,NC_006690,NC_006402,NC_006403,NC_006405,NC_006406,NC_006408,NC_008975,NC_005794,NC_005055,NC_002805,NC_001573');
			$("#nameset0").val('Caudata');
			$("#nameset1").val('Gymnophiona');
			$("#nameset2").val('Anura');
			$("#colorset0").val('green');
			$("#colorset1").val('cyan');
			$("#colorset2").val('blue');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();		
		});
		$("#dataset5").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('1');
			$("#numofsets").trigger("change");
			$("#set0").html('DQ642846,AAXT01000007,KT428643,AAGK01000009,KP866208,AY217738,NC_001799,HM222968,HM222967,AB818490,LC008447,GU591327,GU591328,JX094304,GQ358203,KT428890,KP899713,EF508371,X70810,AJ294725,NC_020460,NC_024154,JN643723,U30821,AY741371,KC573041,JN117275,KC900889,KJ201907,DQ851108,KF438023,KP714733,NC_000925,KC904971,AP006715,AB002583,AF022186,KJ700459,KJ569775,NC_023133,KP308097,KC153978,KP308096,HF562234,KF861575,AY673996,KP330491,KC894740,KC509522,KR709240,KC509523,AP011960,EF067920,KF733443,KJ958479,KC509524,KC509521,KJ958482,KJ958480,KJ958481,KJ958483,GU323224,EF067921,KJ958485,KC509519,KC509520,JQ088178,NC_001713,KJ958484,KC509525,KJ877675,KC598090,KJ410684,KJ624065,GQ231541,GQ231542,JX297813,FP102296,NC_016735,KP298002,KR336545,JQ405663,EU912438,EU168191,KT625420,KT625419,GU196268,DQ630521,HQ700713,KT625418,FJ423446,KT625412,KM462869,GQ250046,KT625415,KT625422,AP012494,JX977846,GU084820,KT625414,KT625413,EU677193,KT625421,KT625411,DQ396875,KT625410,KM462883,DQ291132,KM462870,FJ968740,KM462867,KJ746601,KJ746602,NC_024811,CR954199,FJ858267,FJ493497,KJ746600,AF137379,KJ746597,KJ746598,KJ746599,FJ493498,FJ493499,KM462884,KM462865,KC843975,KJ718922,NC_001865,KM462871,KM462888,KJ001761,FJ968741,DQ398104,KM462878,HQ693844,EF506945,KM462885,KM462860,KM462887,KM462882,KM462868,KM462876,KM462864,KM462861,KM462873,KM462879,KM462880,KM462862,KM462866,KM462886,JX402620,KM462863,KM462872,GQ892829,LN810504,LN810505,KM462877,AY835431,KP720616,DQ229107,DQ422812,AF494278,AB086179,KP765733,KM111545,FJ546412,AP005672,KJ817846,HM222519,EU043314,JX827163,NC_001319,GU191333,AY660566,FJ755183,GU191334,KP099647,JF343520,AP004638,FJ556581,KF225594,KF225592,HM535629,KT599101,AY178864,KC536646,JX402774,AP009339,JX416857,AB684440,NC_011954,KP099649,AP009568,NC_005086,AJ627251,AM712908,KP256024,EF380351,NC_001879,KR230391,AP000423,KT003925,JX427551,FJ754269,KJ956785,KC608752,EU273602,JX088663,KM088013,KJ566306,KJ490011,JX978472,KR534612,KR902497,KM103368,EF115542,KF601567,JN227740,HF937082,NC_001631,KM462881,KJ461680,KM462874,AF166114,AY958085,KJ461682,KJ461681,AY958086');
			$("#nameset0").val('Protists');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();		
		});
		$("#dataset6").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('3');
			$("#numofsets").trigger("change");
			$("#set0").html('AB086179,KP765733,KM111545,FJ546412,AP005672,KJ817846,HM222519,EU043314,JX827163,NC_001319,GU191333,AY660566,FJ755183,GU191334,KP099647,JF343520,AP004638,FJ556581,KF225594,KF225592,HM535629,KT599101,AY178864,KC536646,JX402774,AP009339,JX416857,AB684440,NC_011954,KP099649,AP009568,NC_005086,AJ627251,AM712908,KP256024,EF380351,NC_001879,KR230391,AP000423,KT003925,JX427551,FJ754269,KJ956785,KC608752,EU273602,JX088663,KM088013,KJ566306,KJ490011,JX978472,KR534612,KR902497,KM103368,EF115542,KF601567,JN227740,HF937082,NC_001631,KT625420,KT625419,GU196268,DQ630521,HQ700713,KT625418,FJ423446,KT625412,KM462869,GQ250046,KT625415,KT625422,AP012494,JX977846,GU084820,KT625414,KT625413,EU677193,KT625421,KT625411,DQ396875,KT625410,KM462883,DQ291132,KM462870,FJ968740,KM462867,KJ746601,KJ746602,NC_024811,CR954199,FJ858267,FJ493497,KJ746600,AF137379,KJ746597,KJ746598,KJ746599,FJ493498,FJ493499,KM462884,KM462865,KC843975,KJ718922,NC_001865,KM462871,KM462888,KJ001761,FJ968741,DQ398104,KM462878,HQ693844,EF506945,KM462885,KM462860,KM462887,KM462882,KM462868,KM462876,KM462864,KM462861,KM462873,KM462879,KM462880,KM462862,KM462866,KM462886,JX402620,KM462863,KM462872,GQ892829,LN810504,LN810505,KM462877,AY835431,KP720616,DQ229107,DQ422812,AF494278,KM462881,KJ461680,KM462874,AF166114,AY958085,KJ461682,KJ461681,AY958086,DQ851108,KF438023,X70810,AJ294725,NC_020460,NC_024154,JN643723');
			$("#set1").html('U30821');
			$("#set2").html('KP714733,NC_000925,KC904971,AP006715,AB002583,AF022186,KJ700459,KJ569775,NC_023133,KP308097,KC153978,KP308096,HF562234,KF861575,AY673996,KP330491,KC894740,KC509522,KR709240,KC509523,AP011960,EF067920,KF733443,KJ958479,KC509524,KC509521,KJ958482,KJ958480,KJ958481,KJ958483,GU323224,EF067921,KJ958485,KC509519,KC509520,JQ088178,NC_001713,KJ958484,KC509525,KJ877675,KC598090,KJ410684,KJ624065,GQ231541,GQ231542,JX297813,FP102296,NC_016735,KP298002,KR336545,JQ405663,EU912438,EU168191,AY741371,KC573041,JN117275,KC900889,KJ201907,GQ358203,KT428890,KP899713,EF508371,DQ642846,AAXT01000007,KT428643,AAGK01000009,KP866208,AY217738,NC_001799,HM222968,HM222967,AB818490,GU591327,GU591328,JX094304');
			$("#nameset0").val('Green');
			$("#nameset1").val('Glaucophyte');
			$("#nameset2").val('Red');
			$("#colorset0").val('green');
			$("#colorset1").val('blue');
			$("#colorset2").val('red');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();
		});
		$("#dataset7").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('11');
			$("#numofsets").trigger("change");
			$("#set0").html('AB086179,KP765733,KM111545,FJ546412,AP005672,KJ817846,HM222519,EU043314,JX827163,NC_001319,GU191333,AY660566,FJ755183,GU191334,KP099647,JF343520,AP004638,FJ556581,KF225594,KF225592,HM535629,KT599101,AY178864,KC536646,JX402774,AP009339,JX416857,AB684440,NC_011954,KP099649,AP009568,NC_005086,AJ627251,AM712908,KP256024,EF380351,NC_001879,KR230391,AP000423,KT003925,JX427551,FJ754269,KJ956785,KC608752,EU273602,JX088663,KM088013,KJ566306,KJ490011,JX978472,KR534612,KR902497,KM103368,EF115542,KF601567,JN227740,HF937082,NC_001631');
			$("#set1").html('KT625420,KT625419,GU196268,DQ630521,HQ700713,KT625418,FJ423446,KT625412,KM462869,GQ250046,KT625415,KT625422,AP012494,JX977846,GU084820,KT625414,KT625413,EU677193,KT625421,KT625411,DQ396875,KT625410,KM462883,DQ291132,KM462870,FJ968740,KM462867,KJ746601,KJ746602,NC_024811,CR954199,FJ858267,FJ493497,KJ746600,AF137379,KJ746597,KJ746598,KJ746599,FJ493498,FJ493499,KM462884,KM462865,KC843975,KJ718922,NC_001865,KM462871,KM462888,KJ001761,FJ968741,DQ398104,KM462878,HQ693844,EF506945,KM462885,KM462860,KM462887,KM462882,KM462868,KM462876,KM462864,KM462861,KM462873,KM462879,KM462880,KM462862,KM462866,KM462886,JX402620,KM462863,KM462872,GQ892829,LN810504,LN810505,KM462877,AY835431,KP720616,DQ229107,DQ422812,AF494278,KM462881,KJ461680,KM462874,AF166114,AY958085,KJ461682,KJ461681,AY958086');
			$("#set2").html('KP714733,NC_000925,KC904971,AP006715,AB002583,AF022186,KJ700459,KJ569775,NC_023133,KP308097,KC153978,KP308096,HF562234,KF861575,AY673996,KP330491,KC894740');
			$("#set3").html('U30821');
			$("#set4").html('KC509522,KR709240,KC509523,AP011960,EF067920,KF733443,KJ958479,KC509524,KC509521,KJ958482,KJ958480,KJ958481,KJ958483,GU323224,EF067921,KJ958485,KC509519,KC509520,JQ088178,NC_001713,KJ958484,KC509525,KJ877675,KC598090,KJ410684,KJ624065,GQ231541,GQ231542,JX297813,FP102296,NC_016735,KP298002,KR336545,JQ405663,EU912438,EU168191');
			$("#set5").html('DQ851108,KF438023');
			$("#set6").html('AY741371,KC573041,JN117275,KC900889,KJ201907');
			$("#set7").html('X70810,AJ294725,NC_020460,NC_024154,JN643723');
			$("#set8").html('GQ358203,KT428890,KP899713,EF508371');
			$("#set9").html('DQ642846,AAXT01000007,KT428643,AAGK01000009,KP866208,AY217738,NC_001799,HM222968,HM222967,AB818490,GU591327,GU591328,JX094304');
			$("#set10").html('LC008447');
			$("#nameset0").val('Land Plants');
			$("#nameset1").val('Green Algae');
			$("#nameset2").val('Red Algae');
			$("#nameset3").val('Glaucophyte');
			$("#nameset4").val('Stramenopile');
			$("#nameset5").val('Rhizaria');
			$("#nameset6").val('Haptophyceae');
			$("#nameset7").val('Englenozoa');
			$("#nameset8").val('Cryptophyta');
			$("#nameset9").val('Alveoloata');
			$("#nameset10").val('Lepidodinium');
			$("#colorset0").val('green');
			$("#colorset1").val('lime');
			$("#colorset2").val('red');
			$("#colorset3").val('gray');
			$("#colorset4").val('pink');
			$("#colorset5").val('cyan');
			$("#colorset6").val('orange');
			$("#colorset7").val('seagreen');
			$("#colorset8").val('yellow');
			$("#colorset9").val('brown');
			$("#colorset10").val('purple');
		});
		$("#dataset8").click(function(){
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#numofsets").val('3');
			$("#numofsets").trigger("change");
			$("#set0").html('NC_018118,NC_018120,NC_018121,NC_018122,NC_018123,NC_018124,NC_018125,NC_018126,NC_018127,NC_018128,NC_018129,NC_018130,NC_018131,NC_018132,NC_018133,NC_018094,NC_018095,NC_018029,NC_018030,NC_018040,NC_018047,NC_018048,NC_018049,NC_017869,NC_017744,NC_017748,NC_017605,NC_017007,NC_016956,NC_016919,NC_016865,NC_016866,NC_016696,NC_016704,NC_016713,NC_016716,NC_016720,NC_016724,NC_016469,NC_016419,NC_016432,NC_016167,NC_016169,NC_016173,NC_016176,NC_016182,NC_016196,NC_016201,NC_016202,NC_016203,NC_016204,NC_016056,NC_016062,NC_016067,NC_016016,NC_016017,NC_016018,NC_015985,NC_015988,NC_015997,NC_015998,NC_015999,NC_015926,NC_015895,NC_015799,NC_015800,NC_015835,NC_015842,NC_015612,NC_015624,NC_015609,NC_015537,NC_015478,NC_015480,NC_015342,NC_015118,NC_015119,NC_015075,NC_015079,NC_015093,NC_015095,NC_014887,NC_014891,NC_014806,NC_014694,NC_014695,NC_014668,NC_014669,NC_014672,NC_014673,NC_014677,NC_014678,NC_014680,NC_014688,NC_014702,NC_014704,NC_014705,NC_014610,NC_014611,NC_014574,NC_014587,NC_014485,NC_014488,NC_014490,NC_014491,NC_014493,NC_014449,NC_014450,NC_014451,NC_014398,NC_014402,NC_014349,NC_014272,NC_014274,NC_014275,NC_014278,NC_014283,NC_014286,NC_014289,NC_014294,NC_014295,NC_014223,NC_014224,NC_014053,NC_014055,NC_014058,NC_013932,NC_013805,NC_013822,NC_013826,NC_013835,NC_013847,NC_013701,NC_013706,NC_013604,NC_013554,NC_013576,NC_013578,NC_013580,NC_013582,NC_013272,NC_013274,NC_013238,NC_013240,NC_013249,NC_013251,NC_013252,NC_013254,NC_013256,NC_013257,NC_013180,NC_013185,NC_013063,NC_013066,NC_013070,NC_012888,NC_012893,NC_012901,NC_012817,NC_012819,NC_012820,NC_012822,NC_012823,NC_012835,NC_012838,NC_012841,NC_012842,NC_012845,NC_012765,NC_012739,NC_012727,NC_012708,NC_012688,NC_012689,NC_012644,NC_012645,NC_012617,NC_012446,NC_012449,NC_012456,NC_012457,NC_012458,NC_012459,NC_012460,NC_012462,NC_012463,NC_012464,NC_012421,NC_012424,NC_012429,NC_012432,NC_012139,NC_012144,NC_011923,NC_011813,NC_011823,NC_011824,NC_011827,NC_011755,NC_011717,NC_011596,NC_011594,NC_011524,NC_011520,NC_011359,NC_011320,NC_011322,NC_011324,NC_011326,NC_011328,NC_011329,NC_011301,NC_011302,NC_011303,NC_011305,NC_011306,NC_011276,NC_011277,NC_011278,NC_011197,NC_011200,NC_011119,NC_011114,NC_011115,NC_011128,NC_011095,NC_010964,NC_010967,NC_010969,NC_010613,NC_010568,NC_010532,NC_010522,NC_010266,NC_010241,NC_010219,NC_009983,NC_009967,NC_009964,NC_009876,NC_009809,NC_009770,NC_009771,NC_009772,NC_009733,NC_009498,NC_009499,NC_009500,NC_009501,NC_008754,NC_008755,NC_008756,NC_008748,NC_008323,NC_008221,NC_008141,NC_008070,NC_007976,NC_007884,NC_007688,NC_007701,NC_007702,NC_007102,NC_006895,NC_006899,NC_006817,NC_006678,NC_006378,NC_006279,NC_006280,NC_006292,NC_006157,NC_006158,NC_006159,NC_006160,NC_006133,NC_006076,NC_006080,NC_005939,NC_005944,NC_005779,NC_005780,NC_005781,NC_005437,NC_005333,NC_004816,NC_004622,NC_004529,NC_004371,NC_003970,NC_003395,NC_003372,NC_003367,NC_003368,NC_003081,NC_002697,NC_002651,NC_002609,NC_002660,NC_002355,NC_000857,NC_000875,NC_001322,NC_001566,NC_001709,NC_001712,NC_002084');
			$("#set1").html('NC_018115,NC_018116,NC_018096,NC_018098,NC_018032,NC_018053,NC_018057,NC_018058,NC_018059,NC_018060,NC_018061,NC_018062,NC_018063,NC_017599,NC_016920,NC_016871,NC_016872,NC_016873,NC_016662,NC_016666,NC_016689,NC_016707,NC_016470,NC_016421,NC_016422,NC_016427,NC_016428,NC_016178,NC_016189,NC_016191,NC_016055,NC_016060,NC_016061,NC_016008,NC_015889,NC_015828,NC_015841,NC_015529,NC_015484,NC_015485,NC_015486,NC_015241,NC_015243,NC_015247,NC_015112,NC_015072,NC_015108,NC_014855,NC_014871,NC_014858,NC_014861,NC_014864,NC_014867,NC_014875,NC_014770,NC_014682,NC_014692,NC_014696,NC_014698,NC_014701,NC_014703,NC_014453,NC_014456,NC_014042,NC_014044,NC_014045,NC_014047,NC_014051,NC_013996,NC_013993,NC_013834,NC_013836,NC_013840,NC_013751,NC_013753,NC_013700,NC_013558,NC_013563,NC_013571,NC_013445,NC_013276,NC_013068,NC_013069,NC_012920,NC_012761,NC_012762,NC_012763,NC_012764,NC_012766,NC_012769,NC_012771,NC_012773,NC_012774,NC_012775,NC_012706,NC_012694,NC_012681,NC_012682,NC_012683,NC_012684,NC_012670,NC_012461,NC_012346,NC_012374,NC_012387,NC_012389,NC_012141,NC_012095,NC_012096,NC_012098,NC_012100,NC_012102,NC_012103,NC_012051,NC_012059,NC_012062,NC_012053,NC_012057,NC_012058,NC_012061,NC_011944,NC_011949,NC_011821,NC_011822,NC_011638,NC_011579,NC_011519,NC_011358,NC_011218,NC_011304,NC_011137,NC_011120,NC_011117,NC_011118,NC_011124,NC_011125,NC_011112,NC_011116,NC_011053,NC_011029,NC_010650,NC_010638,NC_010640,NC_010641,NC_010642,NC_010497,NC_010339,NC_010340,NC_010298,NC_010299,NC_010300,NC_010301,NC_010302,NC_010304,NC_009971,NC_009968,NC_009969,NC_009970,NC_009849,NC_009747,NC_009748,NC_009677,NC_009678,NC_009685,NC_009686,NC_009691,NC_009692,NC_009628,NC_009629,NC_009574,NC_009510,NC_009492,NC_009331,NC_009126,NC_009056,NC_008830,NC_008753,NC_008749,NC_008491,NC_008462,NC_008447,NC_008450,NC_008414,NC_008415,NC_008416,NC_008417,NC_008418,NC_008419,NC_008420,NC_008421,NC_008422,NC_008423,NC_008424,NC_008425,NC_008426,NC_008427,NC_008428,NC_008429,NC_008430,NC_008431,NC_008432,NC_008433,NC_008434,NC_008215,NC_008216,NC_008217,NC_008218,NC_008219,NC_008220,NC_008156,NC_008133,NC_008134,NC_008135,NC_008136,NC_008137,NC_008145,NC_008092,NC_008093,NC_008064,NC_008066,NC_007936,NC_007937,NC_007938,NC_007703,NC_007704,NC_007629,NC_007630,NC_007631,NC_007632,NC_007596,NC_007441,NC_007393,NC_007179,NC_007009,NC_006993,NC_006973,NC_006914,NC_006915,NC_006923,NC_006924,NC_006925,NC_006926,NC_006927,NC_006928,NC_006929,NC_006930,NC_006931,NC_006893,NC_006900,NC_006901,NC_006853,NC_006835,NC_006516,NC_006517,NC_006518,NC_006519,NC_006520,NC_006521,NC_006522,NC_006523,NC_006524,NC_006380,NC_006364,NC_006299,NC_006295,NC_005971,NC_005943,NC_005825,NC_005826,NC_005828,NC_005829,NC_005433,NC_005434,NC_005435,NC_005436,NC_005358,NC_005314,NC_005315,NC_005268,NC_005269,NC_005270,NC_005271,NC_005272,NC_005273,NC_005274,NC_005275,NC_005276,NC_005277,NC_005278,NC_005279,NC_005280,NC_005212,NC_005129,NC_005089,NC_005044,NC_005033,NC_005034,NC_005035,NC_004919,NC_004920,NC_004921,NC_004577,NC_004563,NC_004069,NC_004023,NC_004025,NC_004026,NC_004027,NC_004028,NC_004029,NC_004030,NC_004031,NC_004032,NC_003426,NC_003427,NC_003428,NC_003321,NC_003322,NC_003314,NC_003033,NC_003040,NC_003041,NC_002811,NC_002808,NC_002763,NC_002764,NC_002765,NC_003039,NC_002746,NC_002658,NC_002631,NC_002619,NC_002626,NC_002612,NC_002521,NC_002504,NC_002503,NC_002369,NC_002391,NC_000884,NC_000889,NC_000891,NC_001643,NC_001644,NC_001645,NC_001646,NC_002080,NC_000845,NC_001321,NC_001325,NC_001601,NC_001602,NC_001610,NC_001640,NC_001665,NC_001700,NC_001779,NC_001788,NC_001794,NC_001808,NC_001821,NC_001892,NC_001913,NC_001941,NC_001992,NC_002008,NC_002009,NC_002078,NC_002082,NC_002083,NC_000934');
			$("#set2").html('NC_017870,NC_017871,NC_016119,NC_016059,NC_015788,NC_015790,NC_015791,NC_015792,NC_015794,NC_015795,NC_015796,NC_015615,NC_015617,NC_015618,NC_015620,NC_015305,NC_014685,NC_014691,NC_014568,NC_014571,NC_014572,NC_014581,NC_014584,NC_013825,NC_013762,NC_013270,NC_012837,NC_012647,NC_012430,NC_011049,NC_010232,NC_010233,NC_010224,NC_009886,NC_009422,NC_009423,NC_009335,NC_009258,NC_009264,NC_008410,NC_008090,NC_008144,NC_008085,NC_008088,NC_008089,NC_008091,NC_008076,NC_008077,NC_008078,NC_008079,NC_008080,NC_008081,NC_008082,NC_008083,NC_008084,NC_007911,NC_007888,NC_007440,NC_007446,NC_007178,NC_006887,NC_006888,NC_006889,NC_006890,NC_006839,NC_006688,NC_006689,NC_006690,NC_006402,NC_006403,NC_006404,NC_006405,NC_006406,NC_006407,NC_006408,NC_006325,NC_006326,NC_006327,NC_006328,NC_006329,NC_006330,NC_006331,NC_006332,NC_006333,NC_006334,NC_006335,NC_006336,NC_006337,NC_006338,NC_006339,NC_006340,NC_006341,NC_006342,NC_006343,NC_006344,NC_006345,NC_006346,NC_006301,NC_006302,NC_006303,NC_006304,NC_006305,NC_008975,NC_005797,NC_005794,NC_005055,NC_004926,NC_004021,NC_002805,NC_002756,NC_002471,NC_001573');
			$("#nameset0").val('Insects');
			$("#nameset1").val('Mammals');
			$("#nameset2").val('Amphibians');
			$("#colorset0").val('brown');
			$("#colorset1").val('red');
			$("#colorset2").val('cyan');
			$("#stepstatus").hide();
			$("#mainprogressbar").hide();
		});

		$("#kmerslen").change(function(){
			fcgrRes = parseInt($("#kmerslen").val());
			console.log("NEW fcgrRes=",fcgrRes);
		});
		$("#getTaxa").change(function(){
			getTaxa = parseInt($("#getTaxa").val());
			console.log("NEW getTaxa=", getTaxa);
		});

		$("#buildmap").click(function(){
			time = new Date();
			step1A = time.getTime();
			$("#file_contents").empty();
			$("#file_contents").hide();
			$("#mainprogressbar").show();
			$("#stepstatus").show();
			$("#stepstatus").html('Step 1 of 3: (NCBI + FCGRs)');
			$('#ncbiprogress').html('0%'); 
			errorHasOccured = false;
			
			// GET "accIDs"
			accIDsSets=[];
			for(var i=0; i<$("#numofsets").val(); i++){
				console.log(i,$("#set"+i).val().split(","));
				var tmpSet = $("#set"+i).val().split(",");
				if(tmpSet[0]!=""){
					accIDsSets.push(tmpSet);
				}
			}
			accIDs = [].concat.apply([], accIDsSets);
			console.log("accIDs=",accIDs);
			if(accIDs.length == 0){
				$("#stepstatus").html('Please eneter at least 2 sequences..');
				return;
			}

			// AJAX CALLS TO NCBI FOR FASTA FILES
			callsNCBIDone=0;
			for(var i=0; i<accIDs.length; i++){
				if(!errorHasOccured){
					loadFastaFromNCBI(i, accIDs[i].trim(), function(ind, accID, output, header){
						allSequences[ind]=[accID, output.length, /**/, buildFCGR(output, fcgrRes), header];
						if(getTaxa){
							getTaxaFromNCBI(ind, accID);
						}else{
							callsNCBIDone += 0.5;
							allSequences[ind][2] = "NotAvailable";
						}
						if(dbg){console.log([ind,accID,output.length,'DONE']);}
						
						callsNCBIDone += 0.5;
						progress = callsNCBIDone*100.0/accIDs.length;
						progress = progress.toFixed(2);
						if(!errorHasOccured){$('#ncbiprogress').html(progress+'%');} 
						if(callsNCBIDone == accIDs.length){
							time = new Date();
							step1B = time.getTime();
							computeDistMatrix();
						}
					});
				}
			}
		});

		$("#numofsets").change(function(){
			var colorList = '';
			for(var i=0; i<labelColors.length; i++){
				colorList += '<option value="'+labelColors[i]+'">'+ labelColors[i]+'</option>';
			}

			$("#file_contents").empty();
			$("#file_contents").hide();
			console.log($("#numofsets").val());
			$("#sets").html('');
			for(var i=0; i<$("#numofsets").val(); i++){
				$("#sets").html($("#sets").html()+'<p>SetName:<input type="text" size="5" id="nameset'+i+'" value="Set['+i+']"> SetColor: <select id="colorset'+i+'">'+colorList+'</select><br><textarea id="set'+i+'" autofocus  rows="2" cols="40"></textarea></p>');
			}
			for(var i=0; i<$("#numofsets").val(); i++){$("#colorset"+i).val(labelColors[i]);}
			if($("#numofsets").val()>0){$("#buildmap").show();}else{$("#buildmap").hide();}
			$("#stepstatus").hide();
		});

	});

	</script>

	<style>
	body {
		margin-bottom: 60px;
	}
	#filenavigate{ 
		display:block; 
		overflow:auto; 
		height:300px; 
	}
	</style>
</head>
<body>

	<div class = "page-header">
		<h1 class="text-center">MoDMaps3D</h1>
	</div>

	<div class="container">
		<ul class="nav nav-tabs" id="guide-tabs">
			<li class="active"><a data-toggle="tab" href="#home">Home</a></li>
			<li><a data-toggle="tab" href="#menu1">Explore a Map</a></li>
			<li><a data-toggle="tab" href="#menu2">Build a Map</a></li>
			<li><a data-toggle="tab" href="#menu3">About</a></li>
		</ul>

		<div class="tab-content">
			<div id="home" class="tab-pane fade in active">
				<h3>Welcome to MoDMaps3D!</h3>
				<p>Here are some of the things you can do with three dimensional Molecular Distance Maps.</p>

				<dl class="dl-horizontal">
					<dt><a href="#" id="goto1">Explore a Map</a></dt>
					<dd>Explore available built-in MoDMaps. These maps provide extensive information for each genomic sequence involved in each map, along with complementary information.</dd>
					<dt><a href="#" id="goto2">Build a Map</a></dt>
					<dd>Build a new MoDMap from scratch tailored to your dataset.</dd>
				</dl>
				<div id="fastafile"></div>
			</div>
			<div id="menu1" class="tab-pane fade">
				<h3>Explore available MoDMaps</h3>
				<p>Here you can find a list of available built-in MoDMaps to explore. Select a map from sidebar, preview its content, and click on "Show Map" to see it in action.</p>
				<div class="col-xs-4 " id="mainfilenavigate">
				</div>
				<div class="col-xs-6 " id="filecontent">
				</div>  
			</div>
			<div id="menu2" class="tab-pane fade">
				<h3>Build your map, for your dataset.</h3>
				<p>Samples you can try:<br>
					<a href="#" id="dataset1">[1] 7mtDNA</a> - 
					<a href="#" id="dataset2">[2] 62mtDNA primates</a> - 
					<a href="#" id="dataset3">[3] 70mtDNA protists</a> - 
					<a href="#" id="dataset4">[4] 112mtDNA amphibia</a> - 
					<a href="#" id="dataset5">[5] 229protists </a> - 
					<a href="#" id="dataset6">[6] 229_3color </a> - 
					<a href="#" id="dataset7">[7] 229_11color </a> - 
					<a href="#" id="dataset8">[8] 790_InsMamAmphi </a>
				</p>
				<dl class="dl-horizontal">
				  	<dt>Length of k-mers:</dt>
				  	<dd>
				  		<select id="kmerslen">
							<option value="3">3 bp</option>
							<option value="4">4 bp</option>
							<option value="5">5 bp</option>
							<option value="6">6 bp</option>
							<option value="7">7 bp</option>
							<option value="8">8 bp</option>
							<option value="9">9 bp</option>
							<option value="10">10 bp</option>
							<option value="11">11 bp</option>
							<option value="12">12 bp</option>
						</select>
					</dd>
					<dt>Get Taxonomy:</dt>
					<dd>
						<select id="getTaxa">
							<option value="0">No (Fast)</option>
							<option value="1">Yes (Slow)</option>
						</select>
					</dd>
					<dt>Number of sets:</dt>
					<dd>
						<select id="numofsets">
							<option value="0">Choose</option>
							<option value="1">1</option>
							<option value="2">2</option>
							<option value="3">3</option>
							<option value="4">4</option>
							<option value="5">5</option>
							<option value="6">6</option>
							<option value="7">7</option>
							<option value="8">8</option>
							<option value="9">9</option>
							<option value="10">10</option>
							<option value="11">11</option> 
						</select>
					</dd>
				</dl>

				<div id="sets"></div>
				<p><input type="submit" id="buildmap" value="Compute MoDMap" style="display:none;" /></p>

				<p id="stepstatus"></p>
				<div id="mainprogressbar" style="display:none;">
				  <div id="ncbiprogress"></div>
				</div>
				
				<p id="file_contents"></p>
			</div>
			<div id="menu3" class="tab-pane fade">
				<h3>About MoDMaps3D</h3>
				<p class="text-left">Coded by Rallis Karamichalis, 2016.</p>
				<p class="text-left">Available on Github: <a href="http://rallis.github.io/MoDMaps3D/">http://rallis.github.io/MoDMaps3D/</a></p>
				<p class="text-left">For more information: [PUBLICATION_DOI].</p>
				
			</div>
		</div>	
	</div>

</body>
</html>


<!-- 
fcgr function

animalia 11 homo chimp
vertebrates map in explore? name+desfcription
hardcode results from browse.php for github
-->
